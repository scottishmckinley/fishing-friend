<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AnglerOS Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root { 
            --navy: #050b14; --card: #121c2b; --sea: #34e89e; 
            --gold: #f4af1b; --white: #f1f2f6; --text: #cbd5e0; 
            --red: #ff4757; --border: #1e293b;
            --gradient: linear-gradient(135deg, #34e89e 0%, #0fb9b1 100%);
        }
        
        body.night-mode { --navy: #000; --card: #1a0000; --sea: #ff4757; --gold: #800000; --text: #ff4757; --border: #330000; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--navy); margin: 0; padding: 10px; color: var(--text); }
        .app-container { max-width: 450px; margin: 0 auto; padding-bottom: 80px; }
        .header h1 { text-align: center; margin: 15px 0; font-size: 1.8rem; font-weight: 900; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 2px; }
        .btn-gps { width: 100%; background: var(--gradient); color: var(--navy); border: none; padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; margin-bottom: 15px; display: block; text-decoration: none; text-align: center; }
        .label { font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 8px; }
        #map { height: 160px; border-radius: 20px; margin-bottom: 15px; border: 1px solid var(--border); }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 10px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); color: var(--white); box-sizing: border-box; outline: none; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 18px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        
        /* Seasonal Radar */
        .radar-box { background: rgba(244, 175, 27, 0.1); border: 1px solid var(--gold); border-radius: 12px; padding: 12px; margin-bottom: 15px; }
        .radar-title { color: var(--gold); font-weight: 900; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 5px; }
        .species-tag { display: inline-block; background: var(--border); padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; margin: 2px; border: 1px solid rgba(255,255,255,0.1); }

        #intelBox { background: rgba(52, 232, 158, 0.1); border: 1px solid var(--sea); border-radius: 12px; padding: 10px; margin-bottom: 10px; font-size: 0.8rem; display: none; }
        .keeper { color: var(--sea); font-weight: bold; }
        .undersize { color: var(--red); font-weight: bold; }

        .diary-log-item { margin-bottom: 15px; border-left: 3px solid var(--border); padding-left: 12px; }
        .catch-card-inner { display: flex; gap: 10px; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; }
        .catch-thumb { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        
        #helpBtn { position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; background: var(--gradient); border-radius: 50%; border: none; font-size: 1.5rem; z-index: 1000; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header"><h1>AnglerOS</h1></div>
    <div id="map"></div>
    
    <div class="radar-box">
        <div class="radar-title">üìç Current Target Radar (UK - Jan)</div>
        <div id="seasonalRadar"></div>
    </div>

    <div class="card">
        <span class="label">Location Select</span>
        <select id="stationSelect" onchange="loadData()"><option value="">-- Select Port --</option></select>
    </div>

    <div id="dashboard" style="display:none;">
        <div class="card">
            <span class="label">Log Catch</span>
            <div id="intelBox"></div>
            <input type="text" id="logFish" placeholder="Species (e.g. Smoothhound, Ray)" oninput="checkIntel()">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                <input type="number" id="logLength" placeholder="cm" oninput="checkIntel()">
                <input type="number" id="logWeight" placeholder="lb">
            </div>
            <button class="btn-gps" onclick="addCatch()">üìñ SAVE TO DIARY</button>
        </div>

        <div class="card">
            <span class="label">Archive</span>
            <div id="diaryContainer"></div>
        </div>
    </div>
</div>

<button id="helpBtn" onclick="toggleHelp()">üìä</button>

<script>
    const KEY = '05819e75195f4d5f8e73742dd5d57c39';
    const PROXY = "https://corsproxy.io/?"; 
    const API_BASE = "https://admiraltyapi.azure-api.net/uktidalapi/api/V1";

    const SPECIES_DB = {
        "bass": { mcrs: 42, bait: "Lures, Peeler, Rag", months: [5,6,7,8,9,10,11] },
        "cod": { mcrs: 35, bait: "Lugworm, Squid", months: [10,11,12,1,2,3] },
        "smoothhound": { mcrs: 51, bait: "Peeler Crab, Hardback", months: [5,6,7,8], note: "Summer star. Hard fighting." },
        "thornback ray": { mcrs: 40, bait: "Bluey, Sandeel, Squid", months: [3,4,5,6,7,8,9,10] },
        "dogfish": { mcrs: 38, bait: "Anything fishy", months: [1,2,3,4,5,6,7,8,9,10,11,12], note: "Lesser Spotted Dogfish (LSD)." },
        "whiting": { mcrs: 27, bait: "Mackerel, Lug", months: [10,11,12,1,2] },
        "plaice": { mcrs: 27, bait: "Ragworm", months: [3,4,5,6,7,8,9] },
        "tope": { mcrs: 0, bait: "Mackerel, Squid", months: [6,7,8,9], note: "Catch & Release only (UK law)." }
    };

    let catches = JSON.parse(localStorage.getItem('fishingCatches')) || [];

    window.onload = () => { initMap(); getStations(); updateRadar(); renderDiary(); };

    function updateRadar() {
        const month = new Date().getMonth() + 1;
        const currentTargets = Object.keys(SPECIES_DB).filter(k => SPECIES_DB[k].months.includes(month));
        document.getElementById('seasonalRadar').innerHTML = currentTargets.map(t => `<span class="species-tag">${t.toUpperCase()}</span>`).join('');
    }

    function checkIntel() {
        const fish = document.getElementById('logFish').value.toLowerCase();
        const len = parseFloat(document.getElementById('logLength').value);
        const box = document.getElementById('intelBox');
        
        const key = Object.keys(SPECIES_DB).find(s => fish.includes(s));
        if (key) {
            const s = SPECIES_DB[key];
            let html = `<b>Baits:</b> ${s.bait}<br>`;
            if(s.note) html += `<i>${s.note}</i><br>`;
            if (len && s.mcrs > 0) {
                const isLegal = len >= s.mcrs;
                html += isLegal ? `<span class="keeper">‚úÖ LEGAL SIZE</span>` : `<span class="undersize">‚ö†Ô∏è UNDERSIZE (MCRS: ${s.mcrs}cm)</span>`;
            }
            box.innerHTML = html; box.style.display = 'block';
        } else { box.style.display = 'none'; }
    }

    async function getStations() {
        const res = await fetch(PROXY + encodeURIComponent(`${API_BASE}/Stations`), { headers: { 'Ocp-Apim-Subscription-Key': KEY } });
        const data = await res.json();
        document.getElementById('stationSelect').innerHTML += data.features.map(f => `<option value="${f.properties.Id}">${f.properties.Name}</option>`).join('');
    }

    async function loadData() {
        document.getElementById('dashboard').style.display = 'block';
    }

    function addCatch() {
        const fish = document.getElementById('logFish').value;
        if(!fish) return;
        catches.unshift({ fish, length: document.getElementById('logLength').value, weight: document.getElementById('logWeight').value, timestamp: new Date().getTime() });
        localStorage.setItem('fishingCatches', JSON.stringify(catches));
        renderDiary();
    }

    function renderDiary() {
        document.getElementById('diaryContainer').innerHTML = catches.map(c => `
            <div class="diary-log-item">
                <div class="catch-card-inner">
                    <div style="flex:1">
                        <div style="font-size:0.6rem; color:var(--gold)">${new Date(c.timestamp).toLocaleDateString()}</div>
                        <div style="font-weight:800;">${c.fish.toUpperCase()} ${c.length?`‚Ä¢ ${c.length}cm`:''}</div>
                    </div>
                </div>
            </div>`).join('');
    }

    function initMap() { L.map('map').setView([54, -2], 5); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(L.map('map')); }
    function toggleHelp() { location.reload(); }
</script>
</body>
</html>
